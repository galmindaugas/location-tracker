<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time and Location Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            color: #333333;
            background-color: #FFFFFF;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        header {
            background-color: #F6F6F6;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        h1 {
            margin: 0;
            color: #333333;
        }
        .card {
            background-color: #FFFFFF;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        #currentTime, #currentLocation, #elapsedTime {
            font-size: 1.2em;
            margin: 10px 0;
        }
        button {
            background-color: #FFD100;
            border: none;
            color: #333333;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 5px;
            font-size: 1em;
        }
        button:hover {
            background-color: #E6BC00;
        }
        button.active {
            background-color: #E6BC00;
            font-weight: bold;
        }
        #logCoughButton {
            background-color: #FF6B6B;
            color: white;
        }
        #logCoughButton:hover {
            background-color: #FF4949;
        }
        #logEntries {
            margin-top: 20px;
            text-align: left;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #F6F6F6;
        }
    </style>
</head>
<body>
    <header>
        <h1>Time and Location Tracker</h1>
    </header>
    <main>
        <div class="card">
            <div id="currentTime"></div>
            <div id="currentLocation">Current Location: None</div>
            <div id="elapsedTime">Elapsed Time: 00:00:00</div>
        </div>
        <div class="card">
            <button onclick="changeLocation('none')" id="noneButton">None</button>
            <button onclick="changeLocation('street')">Street</button>
            <button onclick="changeLocation('market')">Market</button>
            <button onclick="changeLocation('public transport')">Public Transport</button>
            <button onclick="changeLocation('park')">Park</button>
            <button onclick="changeLocation('home')">Home</button>
            <button onclick="changeLocation('office')">Office</button>
            <button onclick="changeLocation('restaurant')">Restaurant</button>
            <button onclick="changeLocation('supermarket')">Supermarket</button>
        </div>
        <div class="card">
            <button id="logCoughButton" onclick="logCough()">Log Cough</button>
        </div>
        <div class="card">
            <button onclick="downloadCSV()">Download Logs (CSV)</button>
        </div>
        <div class="card">
            <h2>Log Entries</h2>
            <div id="logEntries"></div>
        </div>
    </main>

    <script>
        let currentLocation = 'none';
        let startTime;
        let timerInterval = null;
        let logs = [];

        // Load data from local storage
        function loadFromLocalStorage() {
            const storedLogs = localStorage.getItem('locationLogs');
            if (storedLogs) {
                logs = JSON.parse(storedLogs);
            }

            const storedLocation = localStorage.getItem('currentLocation');
            if (storedLocation) {
                currentLocation = storedLocation;
                document.getElementById('currentLocation').textContent = `Current Location: ${currentLocation}`;
                document.querySelector(`button[onclick="changeLocation('${currentLocation}')"]`).classList.add('active');
            }

            const storedStartTime = localStorage.getItem('startTime');
            if (storedStartTime) {
                startTime = new Date(storedStartTime);
                timerInterval = setInterval(updateElapsedTime, 1000);
            } else {
                startTime = new Date();
            }

            updateLogEntries();
        }

        // Save data to local storage
        function saveToLocalStorage() {
            localStorage.setItem('locationLogs', JSON.stringify(logs));
            localStorage.setItem('currentLocation', currentLocation);
            localStorage.setItem('startTime', startTime.toISOString());
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = `Current Time (UTC): ${now.toUTCString()}`;
        }

        function changeLocation(newLocation) {
            const now = new Date();
            if (currentLocation !== newLocation) {
                clearInterval(timerInterval);
                logs.push({
                    location: currentLocation,
                    date: now.toISOString().split('T')[0],
                    timeStarted: startTime.toISOString(),
                    timeEnded: now.toISOString()
                });
                updateLogEntries();
                
                currentLocation = newLocation;
                startTime = now;
                document.getElementById('currentLocation').textContent = `Current Location: ${currentLocation}`;
                document.getElementById('elapsedTime').textContent = 'Elapsed Time: 00:00:00';
                timerInterval = setInterval(updateElapsedTime, 1000);
                
                // Update active button
                document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`button[onclick="changeLocation('${newLocation}')"]`).classList.add('active');

                saveToLocalStorage();
            }
        }

        function updateElapsedTime() {
            const now = new Date();
            const elapsedTime = now - startTime;
            const hours = Math.floor(elapsedTime / 3600000);
            const minutes = Math.floor((elapsedTime % 3600000) / 60000);
            const seconds = Math.floor((elapsedTime % 60000) / 1000);
            document.getElementById('elapsedTime').textContent = `Elapsed Time: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function logCough() {
            const now = new Date();
            const coughEndTime = new Date(now.getTime() + 500); // 0.5 seconds later
            logs.push({
                location: 'my cough',
                date: now.toISOString().split('T')[0],
                timeStarted: now.toISOString(),
                timeEnded: coughEndTime.toISOString()
            });
            updateLogEntries();
            saveToLocalStorage();
        }

        function updateLogEntries() {
            const logEntriesDiv = document.getElementById('logEntries');
            logEntriesDiv.innerHTML = logs.map(log => 
                `<p>${log.location}: ${log.date} ${log.timeStarted.split('T')[1].split('.')[0]} - ${log.timeEnded.split('T')[1].split('.')[0]}</p>`
            ).join('');
            logEntriesDiv.scrollTop = logEntriesDiv.scrollHeight;
        }

        function downloadCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Location,Date,Time Started,Time Ended\n"
                + logs.map(log => 
                    `${log.location},${log.date},${log.timeStarted},${log.timeEnded}`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "location_logs.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize the app
        loadFromLocalStorage();
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        // Save data before the page is unloaded
        window.addEventListener('beforeunload', saveToLocalStorage);
    </script>
</body>
</html>
